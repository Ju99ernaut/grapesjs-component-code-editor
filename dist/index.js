/*! grapesjs-component-code-editor - 1.0.21 */
!function(t,e){'object'==typeof exports&&'object'==typeof module?module.exports=e():'function'==typeof define&&define.amd?define([],e):'object'==typeof exports?exports["grapesjs-component-code-editor"]=e():t["grapesjs-component-code-editor"]=e()}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})}},e={};t.r(e),t.d(e,{default:()=>j,plugin:()=>T});var n='undefined'!=typeof window?window:null,i=null===n,o=i?void 0:n.document,s='addEventListener',r='removeEventListener',a='getBoundingClientRect',c='_a',l='_b',d='_c',p='horizontal',u=function(){return!1},h=i?'calc':['','-webkit-','-moz-','-o-'].filter(function(t){var e=o.createElement('div');return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",f=function(t){return'string'==typeof t||t instanceof String},v=function(t){if(f(t)){var e=o.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},m=function(t,e,n){var i=t[e];return void 0!==i?i:n},g=function(t,e,n,i){if(e){if('end'===i)return 0;if('center'===i)return t/2}else if(n){if('start'===i)return 0;if('center'===i)return t/2}return t},y=function(t,e){var n=o.createElement('div');return n.className="gutter gutter-"+e,n},b=function(t,e,n){var i={};return f(e)?i[t]=e:i[t]=h+"("+e+"% - "+n+"px)",i},C=function(t,e){var n;return(n={})[t]=e+"px",n};const S=function(t,e){if(void 0===e&&(e={}),i)return{};var h,f,S,z,w,E,x=t;Array.from&&(x=Array.from(x));var P=v(x[0]).parentNode,O=getComputedStyle?getComputedStyle(P):null,T=O?O.flexDirection:null,j=m(e,'sizes')||x.map(function(){return 100/x.length}),B=m(e,'minSize',100),M=Array.isArray(B)?B:x.map(function(){return B}),k=m(e,'maxSize',1/0),D=Array.isArray(k)?k:x.map(function(){return k}),A=m(e,'expandToMin',!1),H=m(e,'gutterSize',10),L=m(e,'gutterAlign','center'),W=m(e,'snapOffset',30),_=Array.isArray(W)?W:x.map(function(){return W}),R=m(e,'dragInterval',1),U=m(e,'direction',p),$=m(e,'cursor',U===p?'col-resize':'row-resize'),I=m(e,'gutter',y),V=m(e,'elementStyle',b),F=m(e,'gutterStyle',C);function N(t,e,n,i){var o=V(h,e,n,i);Object.keys(o).forEach(function(e){t.style[e]=o[e]})}function q(){return E.map(function(t){return t.size})}function X(t){return'touches'in t?t.touches[0][f]:t[f]}function Y(t){var e=E[this.a],n=E[this.b],i=e.size+n.size;e.size=t/this.size*i,n.size=i-t/this.size*i,N(e.element,e.size,this[l],e.i),N(n.element,n.size,this[d],n.i)}function G(t){var n,i=E[this.a],o=E[this.b];this.dragging&&(n=X(t)-this.start+(this[l]-this.dragOffset),R>1&&(n=Math.round(n/R)*R),n<=i.minSize+i.snapOffset+this[l]?n=i.minSize+this[l]:n>=this.size-(o.minSize+o.snapOffset+this[d])&&(n=this.size-(o.minSize+this[d])),n>=i.maxSize-i.snapOffset+this[l]?n=i.maxSize+this[l]:n<=this.size-(o.maxSize-o.snapOffset+this[d])&&(n=this.size-(o.maxSize+this[d])),Y.call(this,n),m(e,'onDrag',u)(q()))}function J(){var t=E[this.a].element,e=E[this.b].element,n=t[a](),i=e[a]();this.size=n[h]+i[h]+this[l]+this[d],this.start=n[S],this.end=n[z]}function K(t){var e=function(t){if(!getComputedStyle)return null;var e=getComputedStyle(t);if(!e)return null;var n=t[w];return 0===n?null:n-=U===p?parseFloat(e.paddingLeft)+parseFloat(e.paddingRight):parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)}(P);if(null===e)return t;if(M.reduce(function(t,e){return t+e},0)>e)return t;var n=0,i=[],o=t.map(function(o,s){var r=e*o/100,a=g(H,0===s,s===t.length-1,L),c=M[s]+a;return r<c?(n+=c-r,i.push(0),c):(i.push(r-c),r)});return 0===n?t:o.map(function(t,o){var s=t;if(n>0&&i[o]-n>0){var r=Math.min(n,i[o]-n);n-=r,s=t-r}return s/e*100})}function Q(){var t=this,i=E[t.a].element,s=E[t.b].element;t.dragging&&m(e,'onDragEnd',u)(q()),t.dragging=!1,n[r]('mouseup',t.stop),n[r]('touchend',t.stop),n[r]('touchcancel',t.stop),n[r]('mousemove',t.move),n[r]('touchmove',t.move),t.stop=null,t.move=null,i[r]('selectstart',u),i[r]('dragstart',u),s[r]('selectstart',u),s[r]('dragstart',u),i.style.userSelect='',i.style.webkitUserSelect='',i.style.MozUserSelect='',i.style.pointerEvents='',s.style.userSelect='',s.style.webkitUserSelect='',s.style.MozUserSelect='',s.style.pointerEvents='',t.gutter.style.cursor='',t.parent.style.cursor='',o.body.style.cursor=''}function Z(t){if(!('button'in t)||0===t.button){var i=this,r=E[i.a].element,a=E[i.b].element;i.dragging||m(e,'onDragStart',u)(q()),t.preventDefault(),i.dragging=!0,i.move=G.bind(i),i.stop=Q.bind(i),n[s]('mouseup',i.stop),n[s]('touchend',i.stop),n[s]('touchcancel',i.stop),n[s]('mousemove',i.move),n[s]('touchmove',i.move),r[s]('selectstart',u),r[s]('dragstart',u),a[s]('selectstart',u),a[s]('dragstart',u),r.style.userSelect='none',r.style.webkitUserSelect='none',r.style.MozUserSelect='none',r.style.pointerEvents='none',a.style.userSelect='none',a.style.webkitUserSelect='none',a.style.MozUserSelect='none',a.style.pointerEvents='none',i.gutter.style.cursor=$,i.parent.style.cursor=$,o.body.style.cursor=$,J.call(i),i.dragOffset=X(t)-i.end}}U===p?(h='width',f='clientX',S='left',z='right',w='clientWidth'):'vertical'===U&&(h='height',f='clientY',S='top',z='bottom',w='clientHeight'),j=K(j);var tt=[];function et(t){var e=t.i===tt.length,n=e?tt[t.i-1]:tt[t.i];J.call(n);var i=e?n.size-t.minSize-n[d]:t.minSize+n[l];Y.call(n,i)}return(E=x.map(function(t,e){var n,i={element:v(t),size:j[e],minSize:M[e],maxSize:D[e],snapOffset:_[e],i:e};if(e>0&&((n={a:e-1,b:e,dragging:!1,direction:U,parent:P})[l]=g(H,e-1==0,!1,L),n[d]=g(H,!1,e===x.length-1,L),'row-reverse'===T||'column-reverse'===T)){var o=n.a;n.a=n.b,n.b=o}if(e>0){var r=I(e,U,i.element);!function(t,e,n){var i=F(h,e,n);Object.keys(i).forEach(function(e){t.style[e]=i[e]})}(r,H,e),n[c]=Z.bind(n),r[s]('mousedown',n[c]),r[s]('touchstart',n[c]),P.insertBefore(r,i.element),n.gutter=r}return N(i.element,i.size,g(H,0===e,e===x.length-1,L),e),e>0&&tt.push(n),i})).forEach(function(t){var e=t.element[a]()[h];e<t.minSize&&(A?et(t):t.minSize=e)}),{setSizes:function(t){var e=K(t);e.forEach(function(t,n){if(n>0){var i=tt[n-1],o=E[i.a],s=E[i.b];o.size=e[n-1],s.size=t,N(o.element,o.size,i[l],o.i),N(s.element,s.size,i[d],s.i)}})},getSizes:q,collapse:function(t){et(E[t])},destroy:function(t,e){tt.forEach(function(n){if(!0!==e?n.parent.removeChild(n.gutter):(n.gutter[r]('mousedown',n[c]),n.gutter[r]('touchstart',n[c])),!0!==t){var i=V(h,n.a.size,n[l]);Object.keys(i).forEach(function(t){E[n.a].element.style[t]='',E[n.b].element.style[t]=''})}})},parent:P,pairs:tt}};var z=void 0&&(void 0).__assign||function(){return z=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},z.apply(this,arguments)},w=function(){function t(t,e){this.editor=t,this.$=t.$,this.pfx=t.getConfig("stylePrefix"),this.opts=e,this.canvas=this.findWithinEditor(".".concat(this.pfx,"cv-canvas")),this.panelViews=e.appendTo?this.$(e.appendTo):this.findWithinEditor(".".concat(this.pfx,"pn-").concat(e.panelId)),this.isShowing=!0}return t.prototype.findPanel=function(){var t=this.editor.Panels,e=this.opts.panelId||"";return t.getPanel(e)||t.addPanel({id:e})},t.prototype.findWithinEditor=function(t){return this.$(t,this.editor.getEl())},t.prototype.buildCodeEditor=function(t){var e=this.editor,n=this.opts;return e.CodeManager.createViewer(z({codeName:"html"===t?"htmlmixed":"css",theme:"hopscotch",readOnly:0,autoBeautify:1,autoCloseTags:1,autoCloseBrackets:1,styleActiveLine:1,smartIndent:1},n.codeViewOptions))},t.prototype.buildSection=function(t,e){var n,i=this,o=i.$,s=i.pfx,r=i.opts,a=o("<section></section>"),c="html"===t?r.htmlBtnText:r.cssBtnText,l=r.cleanCssBtn&&"css"===t?"<button class=\"cp-delete-".concat(t," ").concat(s,"btn-prim\">").concat(r.cleanCssBtnText,"</button>"):"";a.append(o("<div class=\"codepanel-separator\"><div class=\"codepanel-label\">".concat(t,"</div><div class=\"cp-btn-container\"> ").concat(l,"<button class=\"cp-apply-").concat(t," ").concat(s,"btn-prim\">").concat(c,"</button></div></div>")));var d=e.getElement();return d.style.height="calc(100% - 30px)",a.append(d),null===(n=this.codePanel)||void 0===n||n.append(a),a.get(0)},t.prototype.buildCodePanel=function(){var t,e,n,i,o,s=this,r=this.$,a=this.editor,c=this.opts.panelId?this.findPanel():null;this.codePanel=r("<div></div>"),null===(t=this.codePanel)||void 0===t||t.addClass("code-panel"),this.htmlCodeEditor=this.buildCodeEditor("html"),this.cssCodeEditor=this.buildCodeEditor("css");var l=[this.buildSection("html",this.htmlCodeEditor),this.buildSection("css",this.cssCodeEditor)];c&&!this.opts.appendTo&&c.set("appendContent",null===(e=this.codePanel)||void 0===e?void 0:e.get(0)).trigger("change:appendContent"),this.opts.appendTo&&r(this.opts.appendTo).append(this.codePanel),this.updateEditorContents(),null===(n=this.codePanel)||void 0===n||n.find(".cp-apply-html").on("click",this.updateHtml.bind(this)),null===(i=this.codePanel)||void 0===i||i.find(".cp-apply-css").on("click",this.updateCss.bind(this)),this.opts.cleanCssBtn&&(null===(o=this.codePanel)||void 0===o||o.find(".cp-delete-css").on("click",this.deleteSelectedCss.bind(this))),S(l,{direction:"vertical",sizes:[50,50],minSize:100,gutterSize:1,onDragEnd:this.refreshEditors.bind(this)}),a.on("component:update",function(){return s.updateEditorContents()}),a.on("stop:preview",function(){var t;s.isShowing&&!s.opts.preserveWidth&&s.canvas.css("width",(null===(t=s.opts.openState)||void 0===t?void 0:t.canvas)||"65%")})},t.prototype.showCodePanel=function(){var t,e,n;this.isShowing=!0,this.updateEditorContents(),null===(t=this.codePanel)||void 0===t||t.css("display","block"),setTimeout(this.refreshEditors.bind(this),320),this.opts.preserveWidth||(this.panelViews.css("width",(null===(e=this.opts.openState)||void 0===e?void 0:e.panel)||"35%"),this.canvas.css("width",(null===(n=this.opts.openState)||void 0===n?void 0:n.canvas)||"65%"))},t.prototype.hideCodePanel=function(){var t,e;this.codePanel&&this.codePanel.css("display","none"),this.isShowing=!1,this.opts.preserveWidth||(this.panelViews.css("width",(null===(t=this.opts.closedState)||void 0===t?void 0:t.panel)||"15%"),this.canvas.css("width",(null===(e=this.opts.closedState)||void 0===e?void 0:e.canvas)||"85%"))},t.prototype.refreshEditors=function(){this.htmlCodeEditor.refresh(),this.cssCodeEditor.refresh()},t.prototype.updateHtml=function(t){null==t||t.preventDefault();var e=this.editor,n=this.component,i=this.htmlCodeEditor.getContent().trim();if(i&&i!==this.previousHtmlCode){this.previousHtmlCode=i;var o="";return this.cssCodeEditor.getContent().split("}\n").filter(function(t){return Boolean(t.trim())}).map(function(t){if(!/}$/.test(t))return"".concat(t,"}")}).forEach(function(t){/^#/.test(t)&&(o+=t)}),i+="<style>".concat(o,"</style>"),"wrapper"===(null==n?void 0:n.attributes.type)?e.setComponents(i):e.select(null==n?void 0:n.replaceWith(i)),i}},t.prototype.updateCss=function(t){null==t||t.preventDefault();var e=this.cssCodeEditor.getContent().trim();if(e&&e!==this.previousCssCode)return this.previousCssCode=e,this.editor.Css.addRules(e),e},t.prototype.deleteSelectedCss=function(t){var e=this;null==t||t.preventDefault(),this.cssCodeEditor.editor.getSelections().forEach(function(t){return e.parseRemove(t)}),this.cssCodeEditor.editor.deleteH()},t.prototype.parseRemove=function(t){var e=this;this.getRules(this.editor.Parser.parseCss(t)).forEach(function(t){t&&e.editor.Css.remove(t)})},t.prototype.getRules=function(t){var e=this.editor,n=e.Selectors;return t.map(function(t){var i=n.get(t.selectors),o=t.state,s=t.selectorsAdd;return e.Css.get(i,o,void 0,{selectorsAdd:s})}).filter(Boolean)},t.prototype.updateEditorContents=function(){var t,e;this.isShowing&&(this.component=this.editor.getSelected(),this.component&&(null===(t=this.htmlCodeEditor)||void 0===t||t.setContent(this.getComponentHtml(this.component)),null===(e=this.cssCodeEditor)||void 0===e||e.setContent(this.editor.CodeManager.getCode(this.component,"css",{cssc:this.editor.Css}))))},t.prototype.getComponentHtml=function(t){var e=this.pfx,n=this.opts,i="",o=t.getEl();n.clearData||null==o||o.classList.remove("".concat(e,"selected"));var s=n.clearData?t.toHTML():"wrapper"===t.attributes.type?null==o?void 0:o.innerHTML:null==o?void 0:o.outerHTML;return n.clearData||null==o||o.classList.add("".concat(e,"selected")),i+=s},t}(),E="open-code",x="code-editor-object",P="code-editor-constructor",O=void 0&&(void 0).__assign||function(){return O=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},O.apply(this,arguments)},T=function(t,e){void 0===e&&(e={});var n=O({panelId:"views-container",appendTo:"",codeViewOptions:{},preserveWidth:!1,clearData:!1,cleanCssBtn:!0,htmlBtnText:"Apply",cssBtnText:"Apply",cleanCssBtnText:"Delete"},e);!function(t,e){var n=t.Commands,i=null;n.add(E,{run:function(t){!i&&(i=new w(t,e))&&i.buildCodePanel(),i.showCodePanel()},stop:function(){i&&i.hideCodePanel()}}),n.add(x,function(){return i}),n.add(P,function(){return w})}(t,n),t.onReady(function(){var e,n=document.createElement("style");n.textContent=(e=t.config.stylePrefix||"",".code-panel {\n    text-align: left;\n    font-size: 1rem;\n    height: 100%;\n    overflow: hidden;\n}\n.code-panel section {\n    flex: 1;\n    height: 50%;\n}\n.code-panel section .codepanel-separator {\n    display: flex;\n    justify-content: space-between;\n    padding-left: 0.6rem;\n    padding-right: 0.6rem;\n}\n.code-panel section .codepanel-label {\n    margin-top: 5px;\n    line-height: 20px;\n    font-size: 13px;\n    color: #aaa;\n    user-select: none;\n    text-transform: uppercase;\n}\n.cp-btn-container {\n    display: flex;\n    justify-content: space-evenly;\n}\n.cp-btn-container .".concat(e,"btn-prim {\n    margin: 2.5px;\n}\n.gutter {\n    cursor: ns-resize;\n    position: relative;\n    background-color: rgba(0, 0, 0, 0.2);\n}\n.gutter:after {\n    content: '';\n    display: block;\n    height: 8px;\n    width: 100%;\n    position: absolute;\n    top: -3px;\n    z-index: 150;\n}\n.code-panel .CodeMirror {\n    height: 100%;\n}\n.cp-delete-css {\n    margin-left: 70%;\n}\n.").concat(e,"pn-views {\n    border-left: 1px solid rgba(0, 0, 0, 0.2);\n    border-bottom: 0;\n}\n.").concat(e,"pn-views-container {\n    box-shadow: initial;\n    border-top: 2px solid rgba(0, 0, 0, 0.2);\n    top: 40px;\n    padding-top: 0;\n    height: calc(100% - 40px);\n}\n.").concat(e,"pn-views-container, .").concat(e,"cv-canvas {\n    transition: width 0.3s ease-in-out;\n} ")),document.head.appendChild(n)})};const j=T;return e})());
//# sourceMappingURL=index.js.map